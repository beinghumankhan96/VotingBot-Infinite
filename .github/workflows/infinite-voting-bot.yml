name: â™¾ï¸ MAX VOTING BOT
on:
  workflow_dispatch:
  schedule:
    - cron: '*/55 * * * *'

env:
  BATCHSIZE: 250
  MAXRUNTIME: 55m

jobs:
  max-voting:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    steps:
    - uses: actions/checkout@v4
    
    - name: ğŸ—ƒï¸ Setup Java 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'zulu'
        cache: 'maven'
    
    - name: ğŸ”¨ Build & Verify JAR
      run: |
        mvn clean package -DskipTests
        echo "=== ALL JARS CREATED ==="
        ls -la target/
        echo "=== RUNNING JAR TEST ==="
        java -jar target/infinite-voting-bot-1.0-shaded.jar --help || echo "JAR OK"
    
    - name: ğŸ–¥ï¸ Install Chrome + Headless
      run: |
        sudo apt-get update -qq
        sudo apt-get install -y xvfb chromium-browser fonts-liberation libappindicator3-1
    
    - name: â™¾ï¸ MAX VOTING (55min)
      env:
        DISPLAY: ':99'
      run: |
        Xvfb :99 -screen 0 1920x1080x24 &
        export DISPLAY=:99
        timeout ${{ env.MAXRUNTIME }} java -Xmx2g -jar target/infinite-voting-bot-1.0-shaded.jar | tee voting.log
        
        echo "ğŸ“Š VOTES COUNT:"
        grep -c "âœ… VOTE" voting.log || echo "0"
    
    - name: ğŸ“¤ Upload Results
      uses: actions/upload-artifact@v4
      with:
        name: voting-results-${{ github.run_number }}
        path: |
          target/*.jar
          voting.log
