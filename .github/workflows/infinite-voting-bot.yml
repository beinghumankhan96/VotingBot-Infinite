name: Max Voting Bot
on: [workflow_dispatch]
jobs:
  deploy:
    runs-on: ubuntu-24.04
    timeout-minutes: 55
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'zulu'
        cache: maven
        
    - name: Build & Run Bot
      run: |
        mvn clean package -DskipTests
        # CRITICAL: Your missing execution step
        sudo apt-get update -qq
        sudo apt-get install -y xvfb chromium-browser
        export DISPLAY=:99
        Xvfb :99 -screen 0 1920x1080x24 -ac > xvfb.log 2>&1 &
        sleep 3
        timeout 50m java -jar target/infinite-voting-bot-1.0.jar
      env:
        BATCH_SIZE: 100  # Reduced from 250
        MAX_RUNTIME: 50m
        
    - uses: actions/upload-artifact@v4
      if: always()
      with:
        name: bot-logs-${{ github.run_number }}
        path: |
          xvfb.log
          voting-log.txt
          target/*.jar
